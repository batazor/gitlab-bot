.job_template_triage: &triage
  stage: triage
  image: ruby:2.4-alpine
  variables:
    GIT_SUBMODULE_STRATEGY: recursive
  before_script:
  - apk add --update git
  - git submodule sync --recursive
  - git submodule update --init --recursive
  - gem install gitlab-triage --no-doc
  script:
  - gitlab-triage
    -H https://code.rightech.io
    -r ./lib/extension
    -f $GITLAB_TRIAGE_FILE
    --token $GITLAB_API_TOKEN
    --source-id $CI_PROJECT_ID
  only:
  - schedules
  retry: 2
  tags:
  - docker

schedule:daily:issues-unlabelled:
  <<: *triage
  variables:
    GITLAB_TRIAGE_FILE: policies/issues-unlabelled.yml

schedule:month:stale-issues:
  <<: *triage
  before_script:
  - export isFirstDay=`date '+%d'`
  - ([[ isFirstDay == 01 ]]) && echo "Run" || exit 0
  variables:
    GITLAB_TRIAGE_FILE: policies/stale-issues.yml
